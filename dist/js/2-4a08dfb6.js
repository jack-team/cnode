webpackJsonp([2],{"0ZyM":function(t,e,a){function o(t){a("4IpI")}var n=a("VU/8")(a("pqZ1"),a("F9dO"),o,"data-v-3a5aea02",null);t.exports=n.exports},"4IpI":function(t,e,a){var o=a("KyUq");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a("rjj0")("76fc74ce",o,!0,{})},"8mi1":function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,'.upload-file[data-v-cd9f12d4]{width:60px;height:60px;border:1px solid #ececec;position:relative}.upload-file input[type=file][data-v-cd9f12d4]{display:none}.upload-file[data-v-cd9f12d4]:after,.upload-file[data-v-cd9f12d4]:before{content:"";display:block;width:60%;height:2px;background-color:#ccc;position:absolute;left:50%;top:50%;-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0);border-radius:2px}.upload-file[data-v-cd9f12d4]:after{height:60%;width:2px;-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0)}',""])},"C/p7":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("TAej"),n=function(t){return t&&t.__esModule?t:{default:t}}(o);e.default=n.default},F9dO:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"has-header",rawName:"v-has-header"}],staticClass:"ms-page bg-white"},[a("THeader",{attrs:{title:"发表主题"}}),t._v(" "),a("form",{staticClass:"sub-form",on:{submit:function(e){e.preventDefault(),t.onSubmit(e)}}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"title",attrs:{type:"text",placeholder:"请输入主题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),t._v(" "),a("div",{staticClass:"content"},[a("textarea",{directives:[{name:"textarea-auto",rawName:"v-textarea-auto"},{name:"model",rawName:"v-model",value:t.content,expression:"content"}],attrs:{placeholder:"请输入内容"},domProps:{value:t.content},on:{input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"upload-group"},[a("p",{staticClass:"name"},[t._v("添加图片")]),t._v(" "),a("div",{staticClass:"upload-image-wrapper"},[t._l(t.imgs,function(t,e){return a("Timage",{key:e,staticClass:"img-list",attrs:{src:t}})}),t._v(" "),a("Upload",{staticClass:"img-upload",attrs:{uploadSuccess:t.uploadSuccess,uploading:t.uploading,uploadEnded:t.uploadEnded,uploadBefore:t.uploadBefore}})],2)]),t._v(" "),a("div",{staticClass:"select-box"},[a("Tselect",{attrs:{options:t.options,title:"请选择发布类型"},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}})],1),t._v(" "),a("TButton",{staticClass:"button"},[t._v("发布")])],1)],1)},staticRenderFns:[]}},KyUq:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".sub-form[data-v-3a5aea02]{display:block;padding:16px 10px}.bg-white[data-v-3a5aea02]{background-color:#fff}.title[data-v-3a5aea02]{height:40px;width:100%;outline:none;border:1px solid #ccc;background-color:#fff;border-radius:2px;padding:0 10px;font-size:14px;color:#555}.title[data-v-3a5aea02]:focus{border-color:#ff7a4c}.content[data-v-3a5aea02]{display:block;background-color:#fff;margin-top:16px;width:100%;border:1px solid #ccc;padding:10px;border-radius:2px}.content textarea[data-v-3a5aea02]{display:block;width:100%;min-height:80px;outline:none;border:none;resize:none;font-size:14px;padding:0;color:#555}.select-box[data-v-3a5aea02]{margin-top:10px}.button[data-v-3a5aea02]{height:42px;width:100%;border-radius:6px;margin-top:30px;font-size:16px}.upload-group[data-v-3a5aea02]{margin-top:16px}.upload-group .name[data-v-3a5aea02]{font-size:16px;color:#666}.upload-image-wrapper[data-v-3a5aea02]{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-top:6px}.upload-image-wrapper .img-list[data-v-3a5aea02]{width:60px;height:60px;margin-right:10px;margin-bottom:10px;border-radius:4px}.upload-image-wrapper .img-upload[data-v-3a5aea02]{margin-bottom:10px;border-radius:4px}",""])},TAej:function(t,e,a){function o(t){a("UtqQ")}var n=a("VU/8")(a("jsWf"),a("l6YQ"),o,"data-v-cd9f12d4",null);t.exports=n.exports},UtqQ:function(t,e,a){var o=a("8mi1");"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);a("rjj0")("cd724742",o,!0,{})},jsWf:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("Gu7T"),n=function(t){return t&&t.__esModule?t:{default:t}}(o),i=function(){return new MouseEvent("click",{bubbles:!1,cancelable:!1,view:window})};e.default={name:"index",props:{uploadBefore:{type:Function,default:function(t){return t()}},uploading:{type:Function,default:function(){}},uploadSuccess:{type:Function,default:function(){}},uploadError:{type:Function,default:function(){}},uploadEnded:{type:Function,default:function(){}},maxSize:{type:Number,default:5}},created:function(){this.loading=!1},methods:{btnClick:function(){this.$refs.el.dispatchEvent(i())},_uploadBefore:function(){this.uploadBefore(this.btnClick.bind(this))},valid:function(t){var e=this,a=null;return[].concat((0,n.default)(t)).some(function(t){var o=t.size,n=t.name;o/1024/1024>e.maxSize&&(a="图片"+n+"大于"+e.maxSize+"M，不能上传！")}),a},onChange:function(t){var e=this,a=t.target,o=a.files,i=new FormData,r=this.valid(o);return r?this.$PopUp.tip(r):!this.loading&&(this.loading=!0,this.uploading(),[].concat((0,n.default)(o)).forEach(function(t){i.append("file",t)}),void this.$http.upload(i).then(function(t){e.uploadSuccess(t)}).catch(function(t){e.uploadError(t)}).finally(function(){a.value="",e.loading=!1,e.uploadEnded()}))}}}},l6YQ:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"upload-file",on:{click:t._uploadBefore}},[a("input",{ref:"el",attrs:{type:"file",accept:"image/*"},on:{change:t.onChange}})])},staticRenderFns:[]}},pqZ1:function(t,e,a){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=a("Dd8w"),i=o(n),r=a("bGai"),s=a("C/p7"),l=o(s),d=a("NYxO");e.default={name:"release",components:{Tselect:r.Tselect,Upload:l.default,Timage:r.Timage},data:function(){return{title:"",content:"",type:"dev",options:[{name:"测试",value:"dev"},{name:"问答",value:"ask"},{name:"分享",value:"share"},{name:"招聘",value:"job"}],imgs:[]}},computed:(0,i.default)({},(0,d.mapState)({userState:function(t){return t.user}})),methods:{transform:function(t){return(t=t.replace(/\n/g,"  "))+this.imgs.map(function(t){return"!["+t+"]("+t+")"}).join("")},uploadBefore:function(t){getUserLogin()?t():this.$openLogin(function(t){t()})},uploadSuccess:function(t){this.imgs=this.imgs.concat(t)},uploading:function(){loading()},uploadEnded:function(){loadingClose()},onSubmit:function(){var t=this,e=trim(this.title),a=trim(this.content),o=null;return e||(o="请输入标题！"),e.length<10&&(o="标题不能小于小于10个字"),a||(o="请输入内容"),a.length<15&&(o="内容不能小于15个字"),o?this.$PopUp.tip(o):getUserLogin()?void this.release():this.$openLogin(function(e){e(),t.release()})},release:function(){var t=this;loading("发布中...");var e=this.title,a=this.content,o=this.type,n=this.userState,i=n.access_token;this.$http.post("/topics",{title:e,tab:o,content:this.transform(a),accesstoken:i}).then(function(e){var a=e.topic_id;t.$PopUp.toast("发布成功！",function(){t.$router.push("/detail/"+a)})}).catch(function(e){var a=e.error_msg;t.$PopUp.alert(a||"发布失败，请重新发布！")}).finally(loadingClose)}}}}});